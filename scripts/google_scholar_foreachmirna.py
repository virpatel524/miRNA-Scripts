import urllib2
import string
import re
import time
import math, csv
import random
import sys, os, string
import requests
import random
import re


proxy_lst = [{'http': '97.77.104.22:3128'}, {'http': '97.77.104.22:80'}, {'http': '107.21.56.41:80'}, {'http': '50.30.152.130:8086'}, {'http': '187.189.81.21:8080'}, {'http': '50.254.4.194:3128'}, {'http': '64.12.236.2:80'}, {'http': '207.91.10.234:8080'}, {'http': '190.202.82.236:3128'}, {'http': '164.132.28.157:3128'}, {'http': '177.234.12.202:3128'}, {'http': '50.240.46.244:7004'}, {'http': '50.206.36.254:3128'}, {'http': '164.132.28.153:3128'}, {'http': '43.226.162.107:8080'}, {'http': '54.187.52.159:8080'}, {'http': '54.187.52.159:3128'}, {'http': '211.110.127.210:3128'}, {'http': '101.26.38.162:80'}, {'http': '168.63.24.174:8123'}, {'http': '31.199.181.130:8080'}, {'http': '210.101.131.231:8080'}, {'http': '204.14.188.53:7004'}, {'http': '117.177.250.152:82'}, {'http': '128.199.129.179:3128'}, {'http': '117.177.250.151:8082'}, {'http': '178.88.64.83:3128'}, {'http': '117.177.250.151:8086'}, {'http': '168.63.24.174:8132'}, {'http': '190.151.23.19:3128'}, {'http': '117.177.250.152:85'}, {'http': '117.177.250.152:86'}, {'http': '117.177.250.151:81'}, {'http': '117.177.250.152:8082'}, {'http': '117.177.250.152:8080'}, {'http': '81.30.71.165:80'}, {'http': '210.101.131.231:8088'}, {'http': '202.188.101.232:3128'}, {'http': '83.128.190.244:80'}, {'http': '200.1.181.126:8080'}, {'http': '203.66.159.46:3128'}, {'http': '92.245.170.251:8443'}, {'http': '82.139.70.104:80'}, {'http': '203.66.159.44:3128'}, {'http': '164.132.57.130:3128'}, {'http': '203.66.159.45:3128'}, {'http': '168.63.24.174:8120'}, {'http': '213.197.20.136:80'}, {'http': '210.101.131.229:8080'}, {'http': '168.63.24.174:8128'}, {'http': '31.207.0.99:3128'}, {'http': '87.255.70.228:3128'}, {'http': '89.28.1.106:3128'}, {'http': '137.135.166.225:8128'}, {'http': '200.195.167.26:8080'}, {'http': '203.156.126.55:3129'}, {'http': '223.31.54.245:81'}, {'http': '37.157.142.7:8080'}, {'http': '103.28.225.169:8080'}, {'http': '186.159.113.6:8080'}, {'http': '117.169.66.230:843'}, {'http': '187.177.14.104:8080'}, {'http': '186.203.134.5:3128'}, {'http': '85.187.115.179:8080'}, {'http': '165.139.149.169:3128'}, {'http': '183.207.228.122:80'}, {'http': '88.159.172.245:80'}, {'http': '217.119.125.102:8081'}, {'http': '189.89.227.117:3128'}, {'http': '222.124.146.81:8080'}, {'http': '117.136.234.8:80'}, {'http': '111.56.32.73:80'}, {'http': '112.5.220.199:80'}, {'http': '203.162.69.22:3128'}, {'http': '187.18.122.211:8080'}, {'http': '111.56.13.150:83'}, {'http': '5.199.150.129:80'}, {'http': '210.1.81.52:80'}, {'http': '111.56.13.150:80'}, {'http': '117.169.66.230:80'}, {'http': '212.158.161.241:80'}, {'http': '137.135.166.225:8121'}, {'http': '177.22.111.113:3128'}, {'http': '117.240.187.35:3128'}, {'http': '61.19.250.51:3128'}, {'http': '58.253.238.243:80'}, {'http': '94.181.34.64:80'}, {'http': '113.161.33.51:8080'}, {'http': '218.90.174.167:3128'}, {'http': '203.172.210.134:8080'}, {'http': '31.31.73.195:3128'}, {'http': '223.19.212.30:80'}, {'http': '223.68.1.38:8000'}, {'http': '117.136.234.1:80'}, {'http': '137.135.166.225:8137'}, {'http': '182.93.219.30:8080'}, {'http': '110.232.76.150:18080'}, {'http': '128.199.69.60:3128'}, {'http': '219.255.197.90:3128'}, {'http': '181.48.0.173:8081'}, {'http': '177.22.133.9:8080'}, {'http': '183.91.87.35:3128'}, {'http': '223.19.196.232:80'}, {'http': '183.245.147.37:80'}, {'http': '66.96.232.100:3128'}, {'http': '190.18.134.27:8080'}, {'http': '177.130.59.66:3128'}, {'http': '77.174.184.148:80'}, {'http': '46.101.192.201:8080'}, {'http': '113.252.181.81:80'}, {'http': '124.244.77.129:80'}, {'http': '111.56.13.150:82'}, {'http': '177.223.218.92:8080'}, {'http': '43.226.162.107:80'}, {'http': '94.210.184.239:80'}, {'http': '190.202.82.238:3128'}, {'http': '212.120.92.190:80'}, {'http': '168.63.24.174:8145'}, {'http': '5.53.16.183:8080'}, {'http': '176.31.117.175:80'}, {'http': '178.207.156.226:8080'}, {'http': '201.132.162.38:8080'}, {'http': '27.131.47.132:8080'}, {'http': '163.177.79.4:8102'}, {'http': '190.85.130.18:3128'}, {'http': '31.173.74.73:8080'}, {'http': '187.60.170.22:3128'}, {'http': '31.163.202.59:8080'}, {'http': '58.181.180.141:8080'}, {'http': '113.107.57.76:80'}, {'http': '200.108.143.123:3128'}, {'http': '202.142.158.114:8080'}, {'http': '43.226.162.110:80'}, {'http': '163.177.79.5:8107'}, {'http': '80.188.79.138:8080'}, {'http': '219.136.231.6:9797'}, {'http': '202.167.248.186:80'}, {'http': '43.226.162.107:8000'}, {'http': '46.10.205.103:8080'}, {'http': '210.56.16.126:8080'}, {'http': '94.141.100.19:8080'}, {'http': '113.20.113.38:8080'}, {'http': '144.76.213.157:3128'}, {'http': '163.177.79.5:8104'}, {'http': '190.0.131.101:80'}, {'http': '124.6.135.170:3128'}, {'http': '139.0.20.60:8080'}, {'http': '92.255.187.219:8080'}, {'http': '138.201.73.94:3128'}, {'http': '58.214.5.229:80'}, {'http': '91.235.91.62:3128'}, {'http': '221.5.70.178:808'}, {'http': '95.158.139.48:8080'}, {'http': '91.121.93.140:9000'}, {'http': '120.52.72.24:80'}, {'http': '163.177.79.5:8106'}, {'http': '137.135.166.225:8124'}, {'http': '123.231.241.138:8080'}, {'http': '218.26.120.170:8080'}, {'http': '5.135.190.199:3128'}, {'http': '176.31.96.198:3128'}, {'http': '197.253.34.22:8080'}, {'http': '177.85.7.139:8080'}, {'http': '201.20.182.122:8080'}, {'http': '213.111.123.68:8080'}, {'http': '177.128.192.113:8089'}, {'http': '93.174.55.82:80'}, {'http': '27.131.47.132:9797'}, {'http': '61.174.10.22:8080'}, {'http': '196.11.90.57:8080'}, {'http': '209.173.8.221:8080'}, {'http': '103.1.48.77:8088'}, {'http': '177.12.2.208:3128'}, {'http': '46.105.214.133:3128'}, {'http': '80.34.223.19:3128'}, {'http': '190.248.153.162:8080'}, {'http': '187.44.1.54:8080'}, {'http': '77.50.220.92:8080'}, {'http': '195.138.86.112:3128'}, {'http': '177.200.82.236:8080'}, {'http': '82.209.49.194:8080'}, {'http': '151.80.108.134:3128'}, {'http': '113.107.57.76:8101'}, {'http': '51.254.86.25:80'}, {'http': '194.242.102.172:8080'}, {'http': '190.104.245.39:8080'}, {'http': '194.154.74.210:8080'}, {'http': '60.191.175.54:3128'}, {'http': '177.125.8.154:3128'}, {'http': '43.229.204.98:8080'}, {'http': '27.254.47.203:80'}, {'http': '118.97.113.170:8080'}, {'http': '187.191.25.15:3128'}, {'http': '94.231.116.134:8080'}, {'http': '85.114.141.155:8000'}, {'http': '85.70.235.229:8080'}, {'http': '122.225.106.35:80'}, {'http': '83.241.46.175:8080'}, {'http': '200.199.34.58:8080'}, {'http': '87.244.181.185:8080'}]


with open(sys.argv[-1],'r') as fle:
	data = [alpha[0] for alpha in list(csv.reader(fle,delimiter='\t'))]


datalst = []

with open('/Users/virpatel/Desktop/pub_stuff/relevant_data/scholar_hits.txt','w') as scholar_txt:
	for i in data:




		site = 'http://scholar.google.com/scholar?as_vis=1&q="%s"+&hl=en&as_sdt=1,18' %(i)
		print site

		hdr = {'User-Agent': 'Mozilla/5.0 (X11; U; Linux i686) Gecko/20071127 Firefox/2.0.0.11',
		       'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8',
		       'Accept-Charset': 'ISO-8859-1,utf-8;q=0.7,*;q=0.3',
		       'Accept-Encoding': 'none',
		       'Accept-Language': 'en-US,en;q=0.8'}

		priv = True

		while priv == True:
			try:
				page = requests.get(site,proxies=random.choice(proxy_lst))
			except:
				continue
			page = page.text
			print page
			if 'Privoxy' in page:
				continue
			if 'detected unusual traffic' in page:
				continue
			else:
				priv = False





		# m = re.search(' (.+?) results', page)
	
		# found = m.group(1)

		reg_return = re.findall(r'\d+ results',page)
		if len(reg_return) == 0:
			scholar_txt.write(i + '\t' + str(0) + '\n')
			time.sleep(random.randint(0,5))
			datalst.append([i,str(0)])
			continue

		found = str(reg_return[0]).split(' ')[0]
		datalst.append([i,found])
		print datalst

		scholar_txt.write(i + '\t' + found + '\n')

		time.sleep(random.randint(0,5))



with open('/Users/virpatel/Desktop/pub_stuff/relevant_data/scholar_hits.txt','w') as scholar_txt:
	for i in datalst:
		scholar_txt.write('%s\t%s\n' %(i[0],i[1]))










